# 功能使用常见问题

本文介绍使用堡垒机实例时的常见问题及解决方案。

堡垒机通过不断地进行版本升级来提供更多的功能和更好的用户体验。堡垒机实例不同版本之间存在功能差异。更多信息，请参见[版本说明](/intl.zh-CN/.md)。功能使用常见问题按照不同版本分为以下模块：

-   **所有版本通用的常见问题**
    -   [通过SSH方式登录堡垒机实例时，能否使用密钥作为认证方式？](#section_r8z_kiw_6f5)
    -   [购买云盾堡垒机后，是否仍然能够直接连接ECS实例的IP？](#section_imj_ebp_6fp)
    -   [如果希望用户只能通过云盾堡垒机实例登录ECS进行运维，不允许以其他方式登录，应如何配置？](#section_0hi_a6u_k87)
    -   [登录堡垒机实例后，单击ECS实例进行登录时，提示失败，应该如何处理？](#section_i0o_6yu_zgy)
    -   [使用WinSCP工具登录SFTP目标服务器时遇到“列出'/root'的目录项时出错”，应该如何处理？](#section_mr6_9be_r92)
    -   [通过私钥方式登录云服务器ECS，仍然提示需要输入密码，该如何解决？](#section_k8j_kfd_h2z)
    -   [堡垒机实例无法连接ECS云服务器？](#section_ona_6i8_tpa)
    -   [运维人员如何修改云盾堡垒机实例的登录密码？](#section_bgx_u3g_sc1)
    -   [云盾堡垒机实例开放哪些端口，是否可以修改？](#section_ris_096_ix5)
-   **V3.2版本常见问题**
    -   [堡垒机哪些版本的实例支持通过调用API接口使用主机、主机组、主机账户、用户、用户组和主机授权功能？](#section_jos_0c0_r4v)
    -   [如何将堡垒机的运维日志转存到日志服务（SLS）中？](#section_jci_n07_scn)
    -   [如何在ECS服务器的安全组中设置放行堡垒机出口IP的规则？](#section_oxi_ae7_96e)
    -   [在云盾堡垒机实例中，如何设置通过内网IP登录ECS服务器？](#section_wk6_xol_goc)
    -   [目标ECS服务器使用的不是SSH、RDP等协议的标准端口，云盾堡垒机实例该如何配置？](#section_vk7_fss_b21)
    -   [堡垒机实例中的审计录像能保存多久？](#section_6i4_e1w_99v)

## 通过SSH方式登录堡垒机实例时，能否使用密钥作为认证方式？

可以。当使用SSH方式登录堡垒机60022端口时，您可以使用密钥或密码作为认证方式。

## 购买云盾堡垒机后，是否仍然能够直接连接ECS实例的IP？

堡垒机实例本身对ECS实例的IP没有进行策略控制，如果您没有配置其他访问控制策略，仍然可以直接连接该ECS实例的IP。

**说明：** 为了保证您服务器运维的合规性及完整性，建议您配置相关访问控制策略，仅允许通过堡垒机实例登录ECS实例进行运维操作。

## 如果希望用户只能通过云盾堡垒机实例登录ECS进行运维，不允许以其他方式登录，应如何配置？

您可以通过设置该ECS实例的安全组，只允许堡垒机实例的IP访问该ECS实例；或者将所有登录凭据收回，仅在堡垒机实例中保存登录凭据，实现用户只能通过堡垒机实例登录ECS云服务器。

## 登录堡垒机实例后，单击ECS实例进行登录时，提示失败，应该如何处理？

请检查登录的ECS实例所在的安全组和ECS实例本身的防火墙设置，确认没有启用禁止堡垒机实例访问ECS服务器运维端口的任何访问控制规则。

## 使用WinSCP工具登录SFTP目标服务器时遇到“列出'/root'的目录项时出错”，应该如何处理？

![列出'/root'的目录项时出错](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0562819951/p4158.png)

您需要在WinSCP登录对话框中，执行以下操作：

1.  在左侧导航栏，选择**环境** \> **目录**。
2.  将**目录读取选项**全部取消选中。
3.  单击**保存**。

![WinSCP登录对话框](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0562819951/p4159.png)

完成以上操作的执行后，重新连接并登录目标服务器。

## 通过私钥方式登录云服务器ECS，仍然提示需要输入密码，该如何解决？

您需要通过以下方式进行排查：

-   确认您所添加的私钥类型。目前堡垒机实例仅支持通过ssh-keygen工具生成的RSA私钥（不支持带密码的私钥）登录ECS服务器。
-   确认所添加的授权组凭据是否正确。您可以通过使用私钥登录ECS云服务器的方式进行验证。

## 堡垒机实例无法连接ECS云服务器？

您需要通过以下方式进行排查：

-   检查目标ECS服务器的相关安全组规则设置是否正确，确保堡垒机实例可以连通ECS实例的相关运维端口。
-   检查ECS服务器自身防火墙或其他中间设备是否存在其它访问连接限制，例如iptables等。
-   检查堡垒机实例中访问该ECS服务器的端口信息，确保所添加的相关凭据信息正确。

## 运维人员如何修改云盾堡垒机实例的登录密码？

您可以通过以下方式修改您的云盾堡垒机实例登录密码：

-   联系堡垒机实例管理员进行修改。
-   登录堡垒机实例后，修改您的登录密码。

## 云盾堡垒机实例开放哪些端口，是否可以修改？

云盾堡垒机实例默认开放以下端口：

-   443（https端口，Web管理页面）
-   60022（SSH运维端口）
-   63389（RDP运维端口）

**说明：** V2和V3.1版本不支持修改系统默认端口。V3.2版本支持修改系统默认端口。

## 堡垒机哪些版本的实例支持通过调用API接口使用主机、主机组、主机账户、用户、用户组和主机授权功能？

堡垒机V3.2.17及以上版本支持。如果您的堡垒机实例为3.2.17及以上版本，您可以通过调用API接口使用堡垒机提供的主机、主机组、主机账户、用户、用户组和主机授权功能。以下是堡垒机支持的API类型：

-   [主机](/intl.zh-CN/API参考/API概览.md)
-   [主机组](/intl.zh-CN/API参考/API概览.md)
-   [主机账户](/intl.zh-CN/API参考/API概览.md)
-   [用户](/intl.zh-CN/API参考/API概览.md)
-   [用户组](/intl.zh-CN/API参考/API概览.md)
-   [主机授权](/intl.zh-CN/API参考/API概览.md)

## 如何将堡垒机的运维日志转存到日志服务（SLS）中？

堡垒机支持将运维日志转存到日志服务对应的Logstore中。运维日志即运维人员使用堡垒机进行运维的操作记录。您配置了运维日志转存，堡垒机在接收到运维记录后，会自动将运维日志转存到日志服务中。您可以参考以下步骤配置堡垒机运维日志转存：

1.  登录[日志服务控制台](https://sls.console.aliyun.com)，并根据页面提示开通日志服务。
2.  在**日志应用**区域，单击**日志审计服务**。
3.  在全局配置页面，参考以下步骤配置审计信息。

    1.  在**中心项目Project所在区域**下拉列表中，选择日志中心化存储的目标地域。
    2.  配置采集同步授权。

        日志审计服务支持手动授权和通过账号密钥辅助授权。您可以选择以下任一方式配置采集同步授权：

        -   **通过账号密钥辅助授权**：输入账号的AccessKey和AccessSecret。

            AccessKey信息不会被保存，仅临时使用。此处AccessKey信息对应的RAM用户需具备RAM读写权限（例如已被授权AliyunRAMFullAccess策略）。

        -   **手动授权**：具体操作，请参见[手动授权日志采集与同步](/intl.zh-CN/应用中心（App）/日志审计服务/手动授权日志采集与同步.md)。
    3.  在云产品列表中，打开堡垒机**操作日志**开关并设置**存储方式**中的存储时间。
    ![审计配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9864086061/p186788.png)

4.  查看堡垒机运维日志。
    1.  在左侧导航栏，单击![审计查询](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9864086061/p186709.png)图标。
    2.  在左侧**中心化**菜单下单击**堡垒机**。
    3.  在堡垒机页签下查看运维日志。

## 如何在ECS服务器的安全组中设置放行堡垒机出口IP的规则？

使用堡垒机对ECS服务器进行运维前，您需要在服务器的安全组中设置放行堡垒机的出口IP的规则。您的ECS服务器中配置了放行堡垒机出口IP的规则后，堡垒机才能和您的ECS服务器正常通信，进行运维审计操作。您可以执行以下步骤设置安全组规则：

1.  登录[云盾堡垒机控制台](https://yundun.console.aliyun.com/?p=bastion)。
2.  定位到进行运维操作的堡垒机实例，将鼠标移动到**出口IP**上方。

    ![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0562819951/p146985.png)

3.  复制并保存该堡垒机的公网IP地址和私网IP地址。
4.  在ECS服务器的安全组中设置放行堡垒机公网IP和私网IP的规则。

    设置安全组规则的具体操作，请参见[添加安全组规则](/intl.zh-CN/安全/安全组/添加安全组规则.md)。


## 在云盾堡垒机实例中，如何设置通过内网IP登录ECS服务器？

您可以通过以下两种方式进行设置：

-   通过导入ECS实例方式导入的ECS服务器，默认是使用内网IP登录。更多信息，请参见[导入阿里云ECS实例](/intl.zh-CN/用户指南（V3.2版本）/管理员手册/主机管理/新建主机.md)。
-   在**资产管理** \> **主机**页面，选择需要修改运维连接IP的主机，并单击**批量** \> **修改运维连接IP**。在修改运维连接IP对话框中，将**主机IP类型**选择为**内网IP**，并单击**确定**。

## 目标ECS服务器使用的不是SSH、RDP等协议的标准端口，云盾堡垒机实例该如何配置？

云盾堡垒机实例支持自定义运维端口，您可以在登录堡垒机实例后，在**资产管理** \> **主机**页面，选择目标服务器，单击**批量** \> **修改运维端口**。在修改运维端口页面，选择使用的协议并输入自定义的运维端口号，再单击**确定**。

## 堡垒机实例中的审计录像能保存多久？

V3.2版本堡垒机实例的审计录像一般可以保存半年以上，审计录像存储在OSS上，当堡垒机存储空间快满时，会自动清除最久的审计日志和录像。

